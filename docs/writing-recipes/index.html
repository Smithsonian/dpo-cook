<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing recipes - Cook Documentation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://smithsonian.github.io/dpo-cook/favicon.ico">

  
  
  <link rel="stylesheet" href="/dpo-cook/css/style.min.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/dpo-cook/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-cook">
      <a href="/dpo-cook/docs/">
        <span>Cook</span>
      </a>
    </li>
    
    <li class="menu-item-recipes">
      <a href="/dpo-cook/recipes/">
        <span>Recipes</span>
      </a>
    </li>
    
    <li class="menu-item-tasks">
      <a href="/dpo-cook/tasks/">
        <span>Tasks</span>
      </a>
    </li>
    
    <li class="menu-item-tools">
      <a href="/dpo-cook/tools/">
        <span>Tools</span>
      </a>
    </li>
    
    <li class="menu-item-github" title="Smithsonian Cook on Github">
      <a href="https://github.com/smithsonian/dpo-cook"><img src="/dpo-cook/images/github.svg" alt="Github"></a>
    </li>
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://smithsonian.github.io/dpo-cook"><img alt="Logo" src="/dpo-cook/images/cook-logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://smithsonian.github.io/dpo-cook"><img alt="Logo" src="/dpo-cook/images/cook-logo.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/dpo-cook/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-cook">
      <a href="/dpo-cook/docs/">
        <span>Cook</span>
      </a>
    </li>
    
    <li class="menu-item-recipes">
      <a href="/dpo-cook/recipes/">
        <span>Recipes</span>
      </a>
    </li>
    
    <li class="menu-item-tasks">
      <a href="/dpo-cook/tasks/">
        <span>Tasks</span>
      </a>
    </li>
    
    <li class="menu-item-tools">
      <a href="/dpo-cook/tools/">
        <span>Tools</span>
      </a>
    </li>
    
    <li class="menu-item-github" title="Smithsonian Cook on Github">
      <a href="https://github.com/smithsonian/dpo-cook"><img src="/dpo-cook/images/github.svg" alt="Github"></a>
    </li>
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
      
        
      
    
      
    
      
    
      
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            

<div class="docs-menu">
  <h4>Cook</h4>
  <ul>
    
    <li class="">
      <a href="/dpo-cook/docs/getting-started/">Getting Started</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/docs/web-api/">Web API</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/docs/web-ui/">Web UI</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/docs/cli/">Remote CLI</a>
    </li>
    
    <li class="active ">
      <a href="/dpo-cook/docs/writing-recipes/">Writing recipes</a>
    </li>
    
  </ul>
</div>

<div class="docs-menu">
  <h4>Recipes</h4>
  <ul>
    
    <li class="">
      <a href="/dpo-cook/recipes/web-thumb/">Recipe: web-thumb</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/recipes/web-multi/">Recipe: web-multi</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/recipes/web-hd/">Recipe: web-hd</a>
    </li>
    
  </ul>
</div>

<div class="docs-menu">
  <h4>Tasks</h4>
  <ul>
    
    <li class="">
      <a href="/dpo-cook/tasks/overview/">Overview</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/log/">Log</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/pickup/">Pickup</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/delivery/">Delivery</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/bake-maps/">BakeMaps</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/cleanup-mesh/">CleanupMesh</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/combine-occlusion/">CombineOcclusion</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/convert-image/">ConvertImage</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/convert-mesh/">ConvertMesh</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/decimate-mesh/">DecimateMesh</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/file-copy/">FileCopy</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/file-operation/">FileOperation</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/fix-mesh/">FixMesh</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/inspect-mesh/">InspectMesh</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/recipe/">Recipe</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/remesh/">Remesh</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/unwrap-mesh/">UnwrapMesh</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tasks/web-asset/">WebAsset</a>
    </li>
    
  </ul>
</div>

<div class="docs-menu">
  <h4>Tools</h4>
  <ul>
    
    <li class="">
      <a href="/dpo-cook/tools/overview/">Overview</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/blender/">Blender</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/image-magick/">Image Magick</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/instant-meshes/">Instant Meshes</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/meshfix/">Meshfix</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/meshlab/">Meshlab</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/meshsmith/">MeshSmith</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/rapid-compact/">RapidCompact</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/reality-capture/">Reality Capture</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/rizom-uv/">Rizom UV</a>
    </li>
    
    <li class="">
      <a href="/dpo-cook/tools/xnormal/">XNormal</a>
    </li>
    
  </ul>
</div>


          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Writing recipes</h1>
<div class="content">
  

<p>In order to know what to do, the cook relies on recipes. A recipe is a JSON document describing a processing workflow, where a set of input files is processed by multiple tools. Recipes don&rsquo;t need to be linear: depending on the outcome of one processing step, a recipe can decide what to do next. If for example a task fails using tool A, it can decide to try again using tool B.</p>

<p>Recipes are controlled by a set of global parameters. Instead of entering the same information again and again for each tool to be executed, parameters are defined once and then automatically fed to each involved tool.</p>

<h3 id="json-schema">JSON Schema</h3>

<p>Global recipe parameters are defined using JSON Schema. When running a recipe, actual parameters are validated against the schema. Documentation for JSON Schema can be found here: <a href="https://json-schema.org/specification.html">https://json-schema.org/specification.html</a></p>

<h3 id="jsonata">JSONata</h3>

<p>Recipes make heavy use of JSONata expressions. Documentation for JSONata can be found here:
<a href="http://docs.jsonata.org/overview.html">http://docs.jsonata.org/overview.html</a></p>

<h3 id="examples">Examples</h3>

<p>Example recipes can be found in <code>server/recipes</code>.<br />
A recipe template is available in <code>server/recipes-test/template.json</code></p>

<h3 id="recipe-template-structure">Recipe template structure</h3>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;00000000-0000-0000-0000-000000000000&#34;</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;template&#34;</span><span class="p">,</span>
    <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Recipe Template&#34;</span><span class="p">,</span>
    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;name_of_first_step_to_be_executed&gt;&#34;</span><span class="p">,</span>

    <span class="nt">&#34;parameterSchema&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;object&#34;</span><span class="p">,</span>
        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;someFile&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
                <span class="nt">&#34;minLength&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nt">&#34;format&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&#34;someFile&#34;</span>
        <span class="p">],</span>
        <span class="nt">&#34;additionalProperties&#34;</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">},</span>

    <span class="nt">&#34;steps&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;log&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;task&#34;</span><span class="p">:</span> <span class="s2">&#34;Log&#34;</span><span class="p">,</span>
            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Enable logging services&#34;</span><span class="p">,</span>
            <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;logToConsole&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&#34;reportFile&#34;</span><span class="p">:</span> <span class="s2">&#34;$baseName(someFile) &amp; &#39;-report.json&#39;&#34;</span>
            <span class="p">},</span>
            <span class="nt">&#34;success&#34;</span><span class="p">:</span> <span class="s2">&#34;&#39;process&#39;&#34;</span><span class="p">,</span>
            <span class="nt">&#34;failure&#34;</span><span class="p">:</span> <span class="s2">&#34;$failure&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;process&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;task&#34;</span><span class="p">:</span> <span class="s2">&#34;Dummy&#34;</span><span class="p">,</span>
            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Dummy Task&#34;</span><span class="p">,</span>
            <span class="nt">&#34;pre&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="p">},</span>
            <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;outcome&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
                <span class="nt">&#34;duration&#34;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="nt">&#34;post&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="p">},</span>
            <span class="nt">&#34;success&#34;</span><span class="p">:</span> <span class="s2">&#34;&#39;delivery&#39;&#34;</span><span class="p">,</span>
            <span class="nt">&#34;failure&#34;</span><span class="p">:</span> <span class="s2">&#34;$failure&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;delivery&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;task&#34;</span><span class="p">:</span> <span class="s2">&#34;Delivery&#34;</span><span class="p">,</span>
            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Send result files back to client&#34;</span><span class="p">,</span>
            <span class="nt">&#34;pre&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;deliverables&#34;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&#34;someFile&#34;</span><span class="p">:</span> <span class="s2">&#34;someFile&#34;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;method&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;$currentDir&#34;</span><span class="p">,</span>
                <span class="nt">&#34;files&#34;</span><span class="p">:</span> <span class="s2">&#34;deliverables&#34;</span>
            <span class="p">},</span>
            <span class="nt">&#34;success&#34;</span><span class="p">:</span> <span class="s2">&#34;$success&#34;</span><span class="p">,</span>
            <span class="nt">&#34;failure&#34;</span><span class="p">:</span> <span class="s2">&#34;$failure&#34;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
          <a href="https://3d.si.edu" target="_blank"><img class="si-logo" src="/dpo-cook/images/si-digitization-logo-neg.svg" alt="Smithsonian Digitization Logo"></a>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/dpo-cook/js/scripts.min.js"></script>
  

  
  
  
    
  


</body>

</html>

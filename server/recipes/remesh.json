{
    "id": "711d1d55-f318-4723-93d9-e30166c8c0bb",
    "name": "remesh",
    "description": "Samples the existing mesh and generates a new quad mesh",
    "version": "2",
    "start": "pickup",

    "parameterSchema": {
        "type": "object",
        "properties": {
            "highPolyMeshFile": {
                "type": "string",
                "minLength": 1,
                "format": "file"
            },
            "baseName": {
                "type": "string",
                "minLength": 1
            },
            "flipY": {
                "type": "boolean",
                "default": false
            },
            "numFaces": {
                "type": "integer",
                "minimum": 10000,
                "multipleOf": 1000,
                "default": 250000
            },
            "quadsOnly": {
                "type": "boolean",
                "default": false
            }
        },
        "required": [
            "highPolyMeshFile"
        ],
        "additionalProperties": false
    },

    "steps": {
        "pickup": {
            "task": "Pickup",
            "description": "Fetch input files from client",
            "pre": {
                "baseName": "$baseName($firstTrue(baseName, highPolyMeshFile))",
                "baseMeshName": "$baseMeshName($firstTrue(baseName, highPolyMeshFile), numFaces)"
            },
            "parameters": {
                "method": "transportMethod",
                "path": "$firstTrue(pickupPath, $currentDir)",
                "files": {
                    "highPolyMeshFile": "highPolyMeshFile"
                }
            },
            "success": "'transform'",
            "failure": "$failure"
        },
        "transform": {
            "task": "ConvertMesh",
            "description": "Rotate mesh upside-down",
            "skip": "$not(flipY)",
            "pre": {
                "transformedMeshFile": "baseName & '-transformed.obj'"
            },
            "parameters": {
                "inputMeshFile": "highPolyMeshFile",
                "outputMeshFile": "transformedMeshFile",
                "swizzle": "'X-Y-Z+'"
            },
            "success": "'remesh'",
            "failure": "$failure"
        },
        "remesh": {
            "task": "Remesh",
            "description": "Generate a new quad-based mesh",
            "pre": {
                "deliverables": {
                    "remeshedFile": "baseMeshName & '-remeshed.obj'"
                }
            },
            "parameters": {
                "inputMeshFile": "$firstTrue(transformedMeshFile, highPolyMeshFile)",
                "outputMeshFile": "deliverables.remeshedFile",
                "numFaces": "numFaces"
            },
            "success": "'delivery'",
            "failure": "$failure"
        },
        "delivery": {
            "task": "Delivery",
            "description": "Send result files back to client",
            "parameters": {
                "method": "transportMethod",
                "path": "$firstTrue(deliveryPath, pickupPath, $currentDir)",
                "files": "deliverables"
            },
            "success": "$success",
            "failure": "$failure"
        }
    }
}
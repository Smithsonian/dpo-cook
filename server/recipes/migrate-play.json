{
    "id": "8a2e8556-3c39-48a2-b432-591f480b7d69",
    "name": "migrate-play",
    "description": "Converts Play boxes to Voyager items/presentations",
    "version": "1",
    "start": "log",

    "parameterSchema": {
        "type": "object",
        "properties": {
            "boxId": {
                "type": "integer"
            },
            "baseName": {
                "type": "string",
                "minLength": 1
            },
            "pickupPath": {
                "type": "string",
                "minLength": 1
            },
            "deliveryPath": {
                "type": "string",
                "minLength": 1
            },
            "transportMethod": {
                "type": "string",
                "enum": [
                    "none",
                    "local"
                ],
                "default": "none"
            }
        },
        "required": [
            "boxId"
        ],
        "additionalProperties": false
    },

    "steps": {
        "log": {
            "task": "Log",
            "parameters": {
                "logToConsole": true,
                "logFile": "baseName & 'log.txt'",
                "reportFile": "baseName & 'report.json'"
            },
            "success": "'migrate'",
            "failure": "$failure"
        },
        "migrate": {
            "task": "MigratePlay",
            "pre": {
                "delivery": {
                }
            },
            "parameters": {
                "boxId": "boxId",
                "baseName": "baseName"
            },
            "post": {
                "delivery": "$result.files"
            },
            "success": "'delivery'",
            "failure": "$failure"
        },
        "webasset": {
            "task": "WebAsset",
            "description": "Create binary, compressed, embedded glTF asset",
            "pre": {
                "deliverables": {
                    "webAssetGlb": "baseMeshMapName & '-web-thumb.glb'",
                    "diffuseMap": "bakeDiffuse ? (baseMeshMapName & '-diffuse.jpg') : ''",
                    "occlusionMap": "bakeOcclusion ? (baseMeshMapName & '-occlusion.jpg') : ''",
                    "normalMap": "bakeNormals ? (baseMeshMapName & '-normals.jpg') : ''"
                }
            },
            "parameters": {
                "outputFile": "deliverables.webAssetGlb",
                "meshFile": "deliverables.unwrappedMesh",
                "diffuseMapFile": "deliverables.diffuseMap",
                "occlusionMapFile": "deliverables.occlusionMap",
                "normalMapFile": "deliverables.normalMap",
                "objectSpaceNormals": "$not(tangentSpaceNormals)",
                "useCompression": true,
                "compressionLevel": 10,
                "embedMaps": true,
                "writeBinary": true
            },
            "success": "'delivery'",
            "failure": "$failure"
        },
        "delivery": {
            "task": "Delivery",
            "description": "Send result files back to client",
            "parameters": {
                "method": "transportMethod",
                "path": "$firstTrue(deliveryPath, pickupPath, $currentDir)",
                "files": "delivery"
            },
            "success": "$success",
            "failure": "$failure"
        }
    }
}